<%- include('../partials/head', { 
    title: 'Add New Partner - Partner Dashboard',
    additionalCSS: ['/css/forms/partner-form.css', '/css/components/buttons.css']
}) %>

<div class="dashboard-layout">
    <%- include('../partials/sidebar') %>
    
    <div class="main-content">
        <div class="content-area">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-header-content">
                    <h1 class="page-title">
                        <%= locals.editMode ? 'Edit Partner' : 'Add New Partner' %>
                    </h1>
                    <p class="page-subtitle">
                        <%= locals.editMode ? 'Update partner information and contract details' : 'Create a new partner record with contract information' %>
                    </p>
                </div>
                <div class="page-actions">
                    <a href="/master-register" class="btn btn-secondary">
                        <span class="icon">‚Üê</span>
                        <span>Back to List</span>
                    </a>
                </div>
            </div>

            <!-- Form Container -->
            <div class="form-container">
                <form id="partnerForm" class="partner-form" method="POST" action="<%= locals.editMode ? `/api/partners/${partner.id}` : '/api/partners' %>">
                    <% if (locals.editMode) { %>
                        <input type="hidden" name="_method" value="PUT">
                        <input type="hidden" name="id" value="<%= partner.id %>">
                    <% } %>

                    <!-- Basic Information Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="section-icon">üè¢</span>
                                Basic Information
                            </h2>
                            <p class="section-description">Essential partner details and identification</p>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="partnerName" class="form-label required">Partner Name</label>
                                <input 
                                    type="text" 
                                    id="partnerName" 
                                    name="partnerName" 
                                    class="form-input" 
                                    placeholder="Enter full partner organization name"
                                    value="<%= locals.editMode ? partner.name : '' %>"
                                    required
                                >
                                <div class="form-help">Official registered name of the partner organization</div>
                            </div>

                            <div class="form-group">
                                <label for="partnerId" class="form-label required">Partner ID</label>
                                <input 
                                    type="text" 
                                    id="partnerId" 
                                    name="partnerId" 
                                    class="form-input" 
                                    placeholder="P-XXX (auto-generated)"
                                    value="<%= locals.editMode ? partner.id : '' %>"
                                    <%= locals.editMode ? 'readonly' : '' %>
                                >
                                <div class="form-help">Unique identifier for the partner</div>
                            </div>

                            <div class="form-group">
                                <label for="partnerType" class="form-label required">Partner Type</label>
                                <select id="partnerType" name="partnerType" class="form-select" required>
                                    <option value="">Select partner type</option>
                                    <option value="Education" <%= locals.editMode && partner.partnerType === 'Education' ? 'selected' : '' %>>Education</option>
                                    <option value="Technology" <%= locals.editMode && partner.partnerType === 'Technology' ? 'selected' : '' %>>Technology</option>
                                    <option value="Healthcare" <%= locals.editMode && partner.partnerType === 'Healthcare' ? 'selected' : '' %>>Healthcare</option>
                                    <option value="Financial" <%= locals.editMode && partner.partnerType === 'Financial' ? 'selected' : '' %>>Financial</option>
                                    <option value="Government" <%= locals.editMode && partner.partnerType === 'Government' ? 'selected' : '' %>>Government</option>
                                    <option value="NGO" <%= locals.editMode && partner.partnerType === 'NGO' ? 'selected' : '' %>>NGO</option>
                                    <option value="Private" <%= locals.editMode && partner.partnerType === 'Private' ? 'selected' : '' %>>Private Sector</option>
                                    <option value="Other" <%= locals.editMode && partner.partnerType === 'Other' ? 'selected' : '' %>>Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="contractStatus" class="form-label required">Contract Status</label>
                                <select id="contractStatus" name="contractStatus" class="form-select" required>
                                    <option value="">Select status</option>
                                    <option value="Draft" <%= locals.editMode && partner.contractStatus === 'Draft' ? 'selected' : '' %>>Draft</option>
                                    <option value="Under Review" <%= locals.editMode && partner.contractStatus === 'Under Review' ? 'selected' : '' %>>Under Review</option>
                                    <option value="In Contracting" <%= locals.editMode && partner.contractStatus === 'In Contracting' ? 'selected' : '' %>>In Contracting</option>
                                    <option value="Signed" <%= locals.editMode && partner.contractStatus === 'Signed' ? 'selected' : '' %>>Signed</option>
                                    <option value="Active" <%= locals.editMode && partner.contractStatus === 'Active' ? 'selected' : '' %>>Active</option>
                                    <option value="Suspended" <%= locals.editMode && partner.contractStatus === 'Suspended' ? 'selected' : '' %>>Suspended</option>
                                    <option value="Terminated" <%= locals.editMode && partner.contractStatus === 'Terminated' ? 'selected' : '' %>>Terminated</option>
                                    <option value="Completed" <%= locals.editMode && partner.contractStatus === 'Completed' ? 'selected' : '' %>>Completed</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Contract Details Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="section-icon">üìÑ</span>
                                Contract Details
                            </h2>
                            <p class="section-description">Contract terms, dates, and financial information</p>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="agreementDate" class="form-label">Agreement Date</label>
                                <input 
                                    type="date" 
                                    id="agreementDate" 
                                    name="agreementDate" 
                                    class="form-input"
                                    value="<%= locals.editMode ? partner.frameworkAgreementDate : '' %>"
                                >
                            </div>

                            <div class="form-group">
                                <label for="commencementDate" class="form-label">Commencement Date</label>
                                <input 
                                    type="date" 
                                    id="commencementDate" 
                                    name="commencementDate" 
                                    class="form-input"
                                    value="<%= locals.editMode ? partner.commencementDate : '' %>"
                                >
                            </div>

                            <div class="form-group">
                                <label for="contractTerm" class="form-label">Contract Term</label>
                                <input 
                                    type="text" 
                                    id="contractTerm" 
                                    name="contractTerm" 
                                    class="form-input" 
                                    placeholder="e.g., 3 years"
                                    value="<%= locals.editMode ? partner.termYears : '' %>"
                                >
                            </div>

                            <div class="form-group">
                                <label for="taskOrder" class="form-label">Task Order</label>
                                <input 
                                    type="text" 
                                    id="taskOrder" 
                                    name="taskOrder" 
                                    class="form-input" 
                                    placeholder="Year 1: May-25 to May-26"
                                    value="<%= locals.editMode ? partner.currentTaskOrder : '' %>"
                                >
                            </div>

                            <div class="form-group">
                                <label for="contractValue" class="form-label">Contract Value (Year 1)</label>
                                <div class="input-group">
                                    <span class="input-group-text">UGX</span>
                                    <input 
                                        type="number" 
                                        id="contractValue" 
                                        name="contractValue" 
                                        class="form-input" 
                                        placeholder="0"
                                        step="1"
                                        min="0"
                                        max="999999999999"
                                        value="<%= locals.editMode ? partner.taskOrderPrice : '' %>"
                                    >
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="regionsOfOperation" class="form-label">Regions of Operation</label>
                                <textarea 
                                    id="regionsOfOperation" 
                                    name="regionsOfOperation" 
                                    class="form-textarea" 
                                    rows="3"
                                    placeholder="e.g., Busia, Tororo, Pallisa, Bulambuli, Kapchorwa, Mbale, Sironko"
                                ><%= locals.editMode ? partner.regionsOfOperation : '' %></textarea>
                                <div class="form-help">Comma-separated list of regions</div>
                            </div>
                        </div>
                    </div>

                    <!-- Financial Information Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="section-icon">üí∞</span>
                                Financial Information
                            </h2>
                            <p class="section-description">Budget allocation, payment tracking, and financial status</p>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="budgetAllocated" class="form-label">Budget Allocated</label>
                                <div class="input-group">
                                    <span class="input-group-text">UGX</span>
                                    <input 
                                        type="number" 
                                        id="budgetAllocated" 
                                        name="budgetAllocated" 
                                        class="form-input" 
                                        placeholder="0"
                                        step="1"
                                        min="0"
                                        max="999999999999"
                                        value="<%= locals.editMode ? partner.budgetAllocated : '' %>"
                                    >
                                </div>
                                <div class="form-help">Total budget allocated to this partner</div>
                            </div>

                            <div class="form-group">
                                <label for="actualSpent" class="form-label">Actual Amount Spent</label>
                                <div class="input-group">
                                    <span class="input-group-text">UGX</span>
                                    <input 
                                        type="number" 
                                        id="actualSpent" 
                                        name="actualSpent" 
                                        class="form-input" 
                                        placeholder="0"
                                        step="1"
                                        min="0"
                                        max="999999999999"
                                        value="<%= locals.editMode ? partner.actualSpent : '' %>"
                                    >
                                </div>
                                <div class="form-help">Total amount actually spent/disbursed</div>
                            </div>

                            <div class="form-group">
                                <label for="financialStatus" class="form-label">Financial Status</label>
                                <select id="financialStatus" name="financialStatus" class="form-select">
                                    <option value="">Select financial status</option>
                                    <option value="On Track" <%= locals.editMode && partner.financialStatus === 'On Track' ? 'selected' : '' %>>On Track</option>
                                    <option value="Under Budget" <%= locals.editMode && partner.financialStatus === 'Under Budget' ? 'selected' : '' %>>Under Budget</option>
                                    <option value="Over Budget" <%= locals.editMode && partner.financialStatus === 'Over Budget' ? 'selected' : '' %>>Over Budget</option>
                                    <option value="Pending Review" <%= locals.editMode && partner.financialStatus === 'Pending Review' ? 'selected' : '' %>>Pending Review</option>
                                    <option value="Suspended" <%= locals.editMode && partner.financialStatus === 'Suspended' ? 'selected' : '' %>>Suspended</option>
                                </select>
                                <div class="form-help">Current financial status of the partnership</div>
                            </div>

                            <div class="form-group">
                                <label for="paymentSchedule" class="form-label">Payment Schedule</label>
                                <select id="paymentSchedule" name="paymentSchedule" class="form-select">
                                    <option value="">Select payment schedule</option>
                                    <option value="Quarterly" <%= locals.editMode && partner.paymentSchedule === 'Quarterly' ? 'selected' : '' %>>Quarterly</option>
                                    <option value="Monthly" <%= locals.editMode && partner.paymentSchedule === 'Monthly' ? 'selected' : '' %>>Monthly</option>
                                    <option value="Bi-annually" <%= locals.editMode && partner.paymentSchedule === 'Bi-annually' ? 'selected' : '' %>>Bi-annually</option>
                                    <option value="Annually" <%= locals.editMode && partner.paymentSchedule === 'Annually' ? 'selected' : '' %>>Annually</option>
                                    <option value="Milestone-based" <%= locals.editMode && partner.paymentSchedule === 'Milestone-based' ? 'selected' : '' %>>Milestone-based</option>
                                </select>
                                <div class="form-help">Frequency of payments to the partner</div>
                            </div>

                            <div class="form-group">
                                <label for="lastPaymentDate" class="form-label">Last Payment Date</label>
                                <input 
                                    type="date" 
                                    id="lastPaymentDate" 
                                    name="lastPaymentDate" 
                                    class="form-input"
                                    value="<%= locals.editMode ? partner.lastPaymentDate : '' %>"
                                >
                                <div class="form-help">Date of the most recent payment</div>
                            </div>

                            <div class="form-group">
                                <label for="nextPaymentDue" class="form-label">Next Payment Due</label>
                                <input 
                                    type="date" 
                                    id="nextPaymentDue" 
                                    name="nextPaymentDue" 
                                    class="form-input"
                                    value="<%= locals.editMode ? partner.nextPaymentDue : '' %>"
                                >
                                <div class="form-help">Date when the next payment is due</div>
                            </div>
                        </div>

                        <!-- Quarterly Payment Tracking -->
                        <div class="form-subsection">
                            <h3 class="subsection-title">Quarterly Payment Tracking</h3>
                            <div class="form-grid quarterly-grid">
                                <div class="form-group">
                                    <label for="q1ActualPaid" class="form-label">Q1 Actual Paid</label>
                                    <div class="input-group">
                                        <span class="input-group-text">UGX</span>
                                        <input 
                                            type="number" 
                                            id="q1ActualPaid" 
                                            name="q1ActualPaid" 
                                            class="form-input" 
                                            placeholder="0"
                                            step="1"
                                            min="0"
                                            value="<%= locals.editMode ? partner.q1ActualPaid : '' %>"
                                        >
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="q2ActualPaid" class="form-label">Q2 Actual Paid</label>
                                    <div class="input-group">
                                        <span class="input-group-text">UGX</span>
                                        <input 
                                            type="number" 
                                            id="q2ActualPaid" 
                                            name="q2ActualPaid" 
                                            class="form-input" 
                                            placeholder="0"
                                            step="1"
                                            min="0"
                                            value="<%= locals.editMode ? partner.q2ActualPaid : '' %>"
                                        >
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="q3ActualPaid" class="form-label">Q3 Actual Paid</label>
                                    <div class="input-group">
                                        <span class="input-group-text">UGX</span>
                                        <input 
                                            type="number" 
                                            id="q3ActualPaid" 
                                            name="q3ActualPaid" 
                                            class="form-input" 
                                            placeholder="0"
                                            step="1"
                                            min="0"
                                            value="<%= locals.editMode ? partner.q3ActualPaid : '' %>"
                                        >
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="q4ActualPaid" class="form-label">Q4 Actual Paid</label>
                                    <div class="input-group">
                                        <span class="input-group-text">UGX</span>
                                        <input 
                                            type="number" 
                                            id="q4ActualPaid" 
                                            name="q4ActualPaid" 
                                            class="form-input" 
                                            placeholder="0"
                                            step="1"
                                            min="0"
                                            value="<%= locals.editMode ? partner.q4ActualPaid : '' %>"
                                        >
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Utilization Rate -->
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="utilizationRate" class="form-label">Utilization Rate (%)</label>
                                <input 
                                    type="number" 
                                    id="utilizationRate" 
                                    name="utilizationRate" 
                                    class="form-input" 
                                    placeholder="0.0"
                                    step="0.1"
                                    min="0"
                                    max="100"
                                    value="<%= locals.editMode ? (partner.utilizationRate ? partner.utilizationRate * 100 : '') : '' %>"
                                >
                                <div class="form-help">Percentage of budget utilized (0-100%)</div>
                            </div>

                            <div class="form-group">
                                <label for="financialComments" class="form-label">Financial Comments</label>
                                <textarea 
                                    id="financialComments" 
                                    name="financialComments" 
                                    class="form-textarea" 
                                    rows="3"
                                    placeholder="Any additional financial notes, observations, or concerns"
                                ><%= locals.editMode ? partner.comments : '' %></textarea>
                                <div class="form-help">Optional notes about financial performance</div>
                            </div>
                        </div>
                    </div>

                    <!-- Key Personnel Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="section-icon">üë•</span>
                                Key Personnel
                            </h2>
                            <p class="section-description">Primary contacts and key staff members</p>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="keyPersonnel" class="form-label">Primary Contact Person</label>
                                <input 
                                    type="text" 
                                    id="keyPersonnel" 
                                    name="keyPersonnel" 
                                    class="form-input" 
                                    placeholder="Full name of primary contact"
                                    value="<%= locals.editMode ? partner.keyPersonnel : '' %>"
                                >
                            </div>

                            <div class="form-group">
                                <label for="contactEmail" class="form-label">Contact Email</label>
                                <input 
                                    type="email" 
                                    id="contactEmail" 
                                    name="contactEmail" 
                                    class="form-input" 
                                    placeholder="primary@partner.com"
                                    value="<%= locals.editMode ? partner.contactEmail : '' %>"
                                >
                            </div>

                            <div class="form-group">
                                <label for="contactPhone" class="form-label">Contact Phone</label>
                                <input 
                                    type="tel" 
                                    id="contactPhone" 
                                    name="contactPhone" 
                                    class="form-input" 
                                    placeholder="+256 XXX XXX XXX"
                                    maxlength="20"
                                    value="<%= locals.editMode ? partner.contactPhone : '' %>"
                                >
                            </div>

                            <div class="form-group">
                                <label for="organizationAddress" class="form-label">Organization Address</label>
                                <textarea 
                                    id="organizationAddress" 
                                    name="organizationAddress" 
                                    class="form-textarea" 
                                    rows="3"
                                    placeholder="Full physical address"
                                ><%= locals.editMode ? partner.address : '' %></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Information Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="section-icon">üìã</span>
                                Additional Information
                            </h2>
                            <p class="section-description">Notes, special requirements, and other details</p>
                        </div>

                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="partnerDescription" class="form-label">Partner Description</label>
                                <textarea 
                                    id="partnerDescription" 
                                    name="partnerDescription" 
                                    class="form-textarea" 
                                    rows="4"
                                    placeholder="Brief description of the partner organization, their services, and capabilities"
                                ><%= locals.editMode ? partner.description : '' %></textarea>
                            </div>

                            <div class="form-group full-width">
                                <label for="specialRequirements" class="form-label">Special Requirements</label>
                                <textarea 
                                    id="specialRequirements" 
                                    name="specialRequirements" 
                                    class="form-textarea" 
                                    rows="3"
                                    placeholder="Any special requirements, compliance needs, or contractual obligations"
                                ><%= locals.editMode ? partner.specialRequirements : '' %></textarea>
                            </div>

                            <div class="form-group full-width">
                                <label for="notes" class="form-label">Internal Notes</label>
                                <textarea 
                                    id="notes" 
                                    name="notes" 
                                    class="form-textarea" 
                                    rows="3"
                                    placeholder="Internal notes and comments (not visible to partner)"
                                ><%= locals.editMode ? partner.notes : '' %></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <div class="actions-left">
                            <button type="button" class="btn btn-secondary" id="saveDraftBtn">
                                <span class="icon">üíæ</span>
                                <span>Save as Draft</span>
                            </button>
                        </div>
                        <div class="actions-right">
                            <a href="/master-register" class="btn btn-outline">
                                <span>Cancel</span>
                            </a>
                            <button type="submit" class="btn btn-primary" id="submitBtn">
                                <span class="icon">‚úÖ</span>
                                <span><%= locals.editMode ? 'Update Partner' : 'Create Partner' %></span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Success/Error Messages -->
            <div id="messageContainer" class="message-container" style="display: none;">
                <div id="messageContent" class="message-content"></div>
            </div>
        </div>
    </div>
</div>

<!-- Load Form JavaScript -->
<script src="/js/forms/partner-form.js"></script>