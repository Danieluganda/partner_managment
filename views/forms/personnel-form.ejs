<%- include('../partials/head', { 
    title: 'Add Personnel - Partner Dashboard',
    additionalCSS: ['/css/forms/personnel-form.css', '/css/components/forms.css']
}) %>

<div class="dashboard-layout">
    <%- include('../partials/sidebar') %>
    
    <div class="main-content">
        <div class="content-area">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-header-content">
                    <h1 class="page-title">
                        <%= locals.editMode ? 'Edit Personnel' : 'Add New Personnel' %>
                    </h1>
                    <p class="page-subtitle">
                        <%= locals.editMode ? 'Update personnel information and contact details' : 'Add personnel to the directory with contact information' %>
                    </p>
                </div>
                <div class="page-actions">
                    <a href="/key-personnel" class="btn btn-secondary">
                        <span class="icon">‚Üê</span>
                        <span>Back to Directory</span>
                    </a>
                </div>
            </div>

            <!-- Form Container -->
            <div class="form-container">
                <form id="personnelForm" class="personnel-form" method="POST" action="<%= locals.editMode ? `/api/personnel/${personnel.id}` : '/api/personnel' %>">
                    <% if (locals.editMode) { %>
                        <input type="hidden" name="_method" value="PUT">
                        <input type="hidden" name="id" value="<%= personnel.id %>">
                    <% } %>

                    <!-- Partner Association Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="section-icon">üè¢</span>
                                Partner Association
                            </h2>
                            <p class="section-description">Select the partner organization this personnel belongs to</p>
                        </div>

                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="partnerType" class="form-label required">Partner Type</label>
                                <select id="partnerType" name="partnerType" class="form-select" required>
                                    <option value="">Select partner type</option>
                                    <option value="internal" <%= locals.editMode && personnel.partnerType === 'internal' ? 'selected' : '' %>>Internal Partner (Master Register)</option>
                                    <option value="external" <%= locals.editMode && personnel.partnerType === 'external' ? 'selected' : '' %>>External Partner (Partnership Pipeline)</option>
                                </select>
                                <div class="form-help">Choose whether this person belongs to an internal (master register) or external partner</div>
                            </div>

                            <div class="form-group full-width">
                                <label for="partnerId" class="form-label required">Select Partner</label>
                                <select id="partnerId" name="partnerId" class="form-select" required disabled>
                                    <option value="">Select a partner type first</option>
                                </select>
                                <div class="form-help">Select the specific partner organization</div>
                            </div>

                            <div class="form-group">
                                <label for="partnerName" class="form-label">Partner Name</label>
                                <input 
                                    type="text" 
                                    id="partnerName" 
                                    name="partnerName" 
                                    class="form-input" 
                                    readonly
                                    value="<%= locals.editMode ? personnel.partnerName : '' %>"
                                    placeholder="Will be filled automatically"
                                >
                                <div class="form-help">Partner name (auto-filled)</div>
                            </div>

                            <div class="form-group">
                                <label for="partnerStatus" class="form-label">Partner Status</label>
                                <input 
                                    type="text" 
                                    id="partnerStatus" 
                                    name="partnerStatus" 
                                    class="form-input" 
                                    readonly
                                    value="<%= locals.editMode ? personnel.partnerStatus : '' %>"
                                    placeholder="Will be filled automatically"
                                >
                                <div class="form-help">Current partner status (auto-filled)</div>
                            </div>
                        </div>
                    </div>

                    <!-- Personal Information Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="section-icon">üë§</span>
                                Personal Information
                            </h2>
                            <p class="section-description">Basic personal and professional details</p>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="fullName" class="form-label required">Full Name</label>
                                <input 
                                    type="text" 
                                    id="fullName" 
                                    name="fullName" 
                                    class="form-input" 
                                    placeholder="Enter full name"
                                    value="<%= locals.editMode ? personnel.fullName : '' %>"
                                    required
                                >
                            </div>

                            <div class="form-group">
                                <label for="jobTitle" class="form-label required">Job Title</label>
                                <input 
                                    type="text" 
                                    id="jobTitle" 
                                    name="jobTitle" 
                                    class="form-input" 
                                    placeholder="e.g., Project Manager, CEO, Technical Lead"
                                    value="<%= locals.editMode ? personnel.jobTitle : '' %>"
                                    required
                                >
                            </div>

                            <div class="form-group">
                                <label for="department" class="form-label">Department</label>
                                <select id="department" name="department" class="form-select">
                                    <option value="">Select department</option>
                                    <option value="Executive" <%= locals.editMode && personnel.department === 'Executive' ? 'selected' : '' %>>Executive</option>
                                    <option value="Operations" <%= locals.editMode && personnel.department === 'Operations' ? 'selected' : '' %>>Operations</option>
                                    <option value="Technology" <%= locals.editMode && personnel.department === 'Technology' ? 'selected' : '' %>>Technology</option>
                                    <option value="Finance" <%= locals.editMode && personnel.department === 'Finance' ? 'selected' : '' %>>Finance</option>
                                    <option value="Human Resources" <%= locals.editMode && personnel.department === 'Human Resources' ? 'selected' : '' %>>Human Resources</option>
                                    <option value="Marketing" <%= locals.editMode && personnel.department === 'Marketing' ? 'selected' : '' %>>Marketing</option>
                                    <option value="Sales" <%= locals.editMode && personnel.department === 'Sales' ? 'selected' : '' %>>Sales</option>
                                    <option value="Legal" <%= locals.editMode && personnel.department === 'Legal' ? 'selected' : '' %>>Legal</option>
                                    <option value="Compliance" <%= locals.editMode && personnel.department === 'Compliance' ? 'selected' : '' %>>Compliance</option>
                                    <option value="Other" <%= locals.editMode && personnel.department === 'Other' ? 'selected' : '' %>>Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="seniority" class="form-label">Seniority Level</label>
                                <select id="seniority" name="seniority" class="form-select">
                                    <option value="">Select level</option>
                                    <option value="C-Level" <%= locals.editMode && personnel.seniority === 'C-Level' ? 'selected' : '' %>>C-Level (CEO, CTO, CFO)</option>
                                    <option value="Senior Management" <%= locals.editMode && personnel.seniority === 'Senior Management' ? 'selected' : '' %>>Senior Management</option>
                                    <option value="Middle Management" <%= locals.editMode && personnel.seniority === 'Middle Management' ? 'selected' : '' %>>Middle Management</option>
                                    <option value="Team Lead" <%= locals.editMode && personnel.seniority === 'Team Lead' ? 'selected' : '' %>>Team Lead</option>
                                    <option value="Senior" <%= locals.editMode && personnel.seniority === 'Senior' ? 'selected' : '' %>>Senior</option>
                                    <option value="Mid-Level" <%= locals.editMode && personnel.seniority === 'Mid-Level' ? 'selected' : '' %>>Mid-Level</option>
                                    <option value="Junior" <%= locals.editMode && personnel.seniority === 'Junior' ? 'selected' : '' %>>Junior</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="section-icon">üìû</span>
                                Contact Information
                            </h2>
                            <p class="section-description">Primary and secondary contact methods</p>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="emailAddress" class="form-label required">Primary Email</label>
                                <input 
                                    type="email" 
                                    id="emailAddress" 
                                    name="emailAddress" 
                                    class="form-input" 
                                    placeholder="name@company.com"
                                    value="<%= locals.editMode ? personnel.emailAddress : '' %>"
                                    required
                                >
                            </div>

                            <div class="form-group">
                                <label for="phoneNumber" class="form-label">Phone Number</label>
                                <input 
                                    type="tel" 
                                    id="phoneNumber" 
                                    name="phoneNumber" 
                                    class="form-input" 
                                    placeholder="+256 XXX XXX XXX"
                                    maxlength="20"
                                    value="<%= locals.editMode ? personnel.phoneNumber : '' %>"
                                >
                            </div>

                            <div class="form-group">
                                <label for="alternateEmail" class="form-label">Alternate Email</label>
                                <input 
                                    type="email" 
                                    id="alternateEmail" 
                                    name="alternateEmail" 
                                    class="form-input" 
                                    placeholder="alternate@company.com"
                                    value="<%= locals.editMode ? personnel.alternateEmail : '' %>"
                                >
                            </div>

                            <div class="form-group">
                                <label for="alternatePhone" class="form-label">Alternate Phone</label>
                                <input 
                                    type="tel" 
                                    id="alternatePhone" 
                                    name="alternatePhone" 
                                    class="form-input" 
                                    placeholder="+256 XXX XXX XXX"
                                    maxlength="20"
                                    value="<%= locals.editMode ? personnel.alternatePhone : '' %>"
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Work Information Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="section-icon">üíº</span>
                                Work Information
                            </h2>
                            <p class="section-description">Office location, reporting structure, and work details</p>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="officeLocation" class="form-label">Office Location</label>
                                <input 
                                    type="text" 
                                    id="officeLocation" 
                                    name="officeLocation" 
                                    class="form-input" 
                                    placeholder="e.g., Kampala HQ, Remote, Mbarara Branch"
                                    value="<%= locals.editMode ? personnel.officeLocation : '' %>"
                                >
                            </div>

                            <div class="form-group">
                                <label for="reportsTo" class="form-label">Reports To</label>
                                <input 
                                    type="text" 
                                    id="reportsTo" 
                                    name="reportsTo" 
                                    class="form-input" 
                                    placeholder="Manager's name or position"
                                    value="<%= locals.editMode ? personnel.reportsTo : '' %>"
                                >
                            </div>

                            <div class="form-group">
                                <label for="workStatus" class="form-label">Work Status</label>
                                <select id="workStatus" name="workStatus" class="form-select">
                                    <option value="">Select status</option>
                                    <option value="Active" <%= locals.editMode && personnel.workStatus === 'Active' ? 'selected' : '' %>>Active</option>
                                    <option value="On Leave" <%= locals.editMode && personnel.workStatus === 'On Leave' ? 'selected' : '' %>>On Leave</option>
                                    <option value="Inactive" <%= locals.editMode && personnel.workStatus === 'Inactive' ? 'selected' : '' %>>Inactive</option>
                                    <option value="Terminated" <%= locals.editMode && personnel.workStatus === 'Terminated' ? 'selected' : '' %>>Terminated</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="preferredContact" class="form-label">Preferred Contact Method</label>
                                <select id="preferredContact" name="preferredContact" class="form-select">
                                    <option value="">Select method</option>
                                    <option value="Email" <%= locals.editMode && personnel.preferredContact === 'Email' ? 'selected' : '' %>>Email</option>
                                    <option value="Phone" <%= locals.editMode && personnel.preferredContact === 'Phone' ? 'selected' : '' %>>Phone</option>
                                    <option value="WhatsApp" <%= locals.editMode && personnel.preferredContact === 'WhatsApp' ? 'selected' : '' %>>WhatsApp</option>
                                    <option value="Teams" <%= locals.editMode && personnel.preferredContact === 'Teams' ? 'selected' : '' %>>Microsoft Teams</option>
                                    <option value="Slack" <%= locals.editMode && personnel.preferredContact === 'Slack' ? 'selected' : '' %>>Slack</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Responsibilities Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="section-icon">üìã</span>
                                Responsibilities & Projects
                            </h2>
                            <p class="section-description">Key responsibilities and current project assignments</p>
                        </div>

                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="responsibilities" class="form-label">Key Responsibilities</label>
                                <textarea 
                                    id="responsibilities" 
                                    name="responsibilities" 
                                    class="form-textarea" 
                                    rows="4"
                                    placeholder="List main responsibilities and duties..."
                                ><%= locals.editMode ? personnel.responsibilities : '' %></textarea>
                            </div>

                            <div class="form-group full-width">
                                <label for="projectAssignments" class="form-label">Current Project Assignments</label>
                                <textarea 
                                    id="projectAssignments" 
                                    name="projectAssignments" 
                                    class="form-textarea" 
                                    rows="3"
                                    placeholder="List current projects and assignments..."
                                ><%= locals.editMode ? personnel.projectAssignments : '' %></textarea>
                            </div>

                            <div class="form-group full-width">
                                <label for="teamMembers" class="form-label">Team Members</label>
                                <textarea 
                                    id="teamMembers" 
                                    name="teamMembers" 
                                    class="form-textarea" 
                                    rows="3"
                                    placeholder="List team members they manage or work with..."
                                ><%= locals.editMode ? personnel.teamMembers : '' %></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Information Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <span class="section-icon">üìù</span>
                                Additional Information
                            </h2>
                            <p class="section-description">Notes, skills, and other relevant information</p>
                        </div>

                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="skills" class="form-label">Skills & Expertise</label>
                                <textarea 
                                    id="skills" 
                                    name="skills" 
                                    class="form-textarea" 
                                    rows="3"
                                    placeholder="List key skills, certifications, or areas of expertise..."
                                ><%= locals.editMode ? personnel.skills : '' %></textarea>
                            </div>

                            <div class="form-group full-width">
                                <label for="notes" class="form-label">Notes</label>
                                <textarea 
                                    id="notes" 
                                    name="notes" 
                                    class="form-textarea" 
                                    rows="3"
                                    placeholder="Any additional notes or comments..."
                                ><%= locals.editMode ? personnel.notes : '' %></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="window.history.back()">
                            <span class="icon">‚úï</span>
                            <span>Cancel</span>
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <span class="icon">üíæ</span>
                            <span><%= locals.editMode ? 'Update Personnel' : 'Add Personnel' %></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<%- include('../partials/footer') %>

<!-- Pass data to JavaScript -->
<script>
    window.partnersData = <%- JSON.stringify(locals.jsData?.partners || []) %>;
    window.externalPartnersData = <%- JSON.stringify(locals.jsData?.externalPartners || []) %>;
    window.editMode = <%= locals.editMode ? 'true' : 'false' %>;
    <% if (locals.editMode && locals.personnel) { %>
        window.personnelData = <%- JSON.stringify(personnel) %>;
    <% } %>
</script>

<script src="/js/forms/personnel-form.js"></script>