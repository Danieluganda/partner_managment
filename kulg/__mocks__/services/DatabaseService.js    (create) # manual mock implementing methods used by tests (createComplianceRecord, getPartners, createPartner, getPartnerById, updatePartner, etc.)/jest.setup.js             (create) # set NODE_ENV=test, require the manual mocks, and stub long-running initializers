const DatabaseService = jest.createMockFromModule('../services/DatabaseService');

DatabaseService.createComplianceRecord = jest.fn((payload) => {
    if (payload.partnerId === 'p-xyz') {
        return {
            ...payload,
            partnerName: null,
            reportingRequirement: null,
            dueDate: null,
        };
    }
    return {
        ...payload,
        partnerName: 'Test Partner',
        reportingRequirement: 'Quarterly report',
        dueDate: new Date('2025-12-14T00:00:00.000Z'),
    };
});

DatabaseService.getPartners = jest.fn(() => {
    return [
        { partnerId: 'p-123', partnerName: 'Test Partner' },
        { partnerId: 'p-xyz', partnerName: 'Unknown Partner' },
    ];
});

DatabaseService.createPartner = jest.fn((partner) => {
    return { id: 'new-partner-id', ...partner };
});

DatabaseService.getPartnerById = jest.fn((id) => {
    if (id === 'p-123') {
        return { partnerId: 'p-123', partnerName: 'Test Partner' };
    }
    return null;
});

DatabaseService.updatePartner = jest.fn((id, updates) => {
    if (id === 'p-123') {
        return { partnerId: 'p-123', ...updates };
    }
    throw new Error('Partner not found');
});

module.exports = DatabaseService;

process.env.NODE_ENV = 'test';
require('../__mocks__/services/DatabaseService');

jest.mock('../services/DatabaseService', () => require('../__mocks__/services/DatabaseService'));