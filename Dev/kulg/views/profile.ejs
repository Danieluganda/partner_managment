<%- include('partials/head') %>
<div class="dashboard-layout">
  <%- include('partials/sidebar') %>
  <div class="main-content">
    <header class="header">
      <div class="header-left">
        <h1>ğŸ‘¤ My Profile</h1>
        <p>Manage your account settings and security</p>
      </div>
    </header>
    <div class="content-area">
      <div class="profile-container">
        
        <!-- Messages -->
        <% if (message) { %>
        <div class="message success">
          âœ… <%= message %>
        </div>
        <% } %>
        <% if (error) { %>
        <div class="message error">
          âŒ <%= error %>
        </div>
        <% } %>

        <!-- Profile Header -->
        <div class="profile-header">
          <div class="profile-avatar">
            <% if (user.profilePicture) { %>
            <img src="<%= user.profilePicture %>" alt="Profile Picture" class="avatar-img">
            <% } else { %>
            <div class="avatar-placeholder">
              <%= user.fullName.charAt(0).toUpperCase() %>
            </div>
            <% } %>
            <div class="user-info">
              <h2><%= user.fullName %></h2>
              <p class="user-meta">@<%= user.username %> â€¢ <%= user.email %></p>
              <div class="user-badges">
                <span class="badge <%= user.role.toLowerCase() %>">
                  <%= user.role === 'ADMIN' ? 'ğŸ‘‘ Admin' : 'ğŸ‘¤ User' %>
                </span>
                <% if (user.twoFactorEnabled) { %>
                <span class="badge security">ğŸ” 2FA Enabled</span>
                <% } %>
                <% if (user.emailVerified) { %>
                <span class="badge verified">âœ… Verified</span>
                <% } %>
              </div>
            </div>
          </div>
          <div class="profile-stats">
            <div class="stat">
              <span class="stat-value"><%= user.loginCount || 0 %></span>
              <span class="stat-label">Total Logins</span>
            </div>
            <div class="stat">
              <span class="stat-value">
                <% if (user.lastLoginAt) { %>
                <%= new Date(user.lastLoginAt).toLocaleDateString() %>
                <% } else { %>
                Never
                <% } %>
              </span>
              <span class="stat-label">Last Login</span>
            </div>
            <div class="stat">
              <span class="stat-value"><%= user.uuid.slice(0, 8) %>...</span>
              <span class="stat-label">User ID</span>
            </div>
          </div>
        </div>

        <!-- Profile Sections -->
        <div class="profile-sections">
          
          <!-- Personal Information -->
          <div class="profile-section">
            <h3>ğŸ“ Personal Information</h3>
            <form action="/profile/update" method="POST" enctype="multipart/form-data" class="profile-form">
              <div class="form-grid">
                <div class="form-group">
                  <label for="fullName">ğŸ‘¤ Full Name</label>
                  <input type="text" id="fullName" name="fullName" value="<%= user.fullName %>" required>
                </div>
                <div class="form-group">
                  <label for="username">ğŸ·ï¸ Username</label>
                  <input type="text" id="username" name="username" value="<%= user.username %>" required>
                </div>
                <div class="form-group">
                  <label for="email">ğŸ“§ Email</label>
                  <input type="email" id="email" name="email" value="<%= user.email %>" required>
                </div>
                <div class="form-group">
                  <label for="phone">ğŸ“± Phone</label>
                  <input type="tel" id="phone" name="phone" value="<%= user.phone || '' %>">
                </div>
                <div class="form-group full-width">
                  <label for="bio">ğŸ“„ Bio</label>
                  <textarea id="bio" name="bio" rows="3" placeholder="Tell us about yourself..."><%= user.bio || '' %></textarea>
                </div>
                <div class="form-group">
                  <label for="timezone">ğŸŒ Timezone</label>
                  <select id="timezone" name="timezone">
                    <option value="UTC" <%= user.timezone === 'UTC' ? 'selected' : '' %>>UTC</option>
                    <option value="America/New_York" <%= user.timezone === 'America/New_York' ? 'selected' : '' %>>Eastern Time</option>
                    <option value="America/Chicago" <%= user.timezone === 'America/Chicago' ? 'selected' : '' %>>Central Time</option>
                    <option value="America/Denver" <%= user.timezone === 'America/Denver' ? 'selected' : '' %>>Mountain Time</option>
                    <option value="America/Los_Angeles" <%= user.timezone === 'America/Los_Angeles' ? 'selected' : '' %>>Pacific Time</option>
                    <option value="Europe/London" <%= user.timezone === 'Europe/London' ? 'selected' : '' %>>London</option>
                    <option value="Europe/Berlin" <%= user.timezone === 'Europe/Berlin' ? 'selected' : '' %>>Berlin</option>
                    <option value="Asia/Tokyo" <%= user.timezone === 'Asia/Tokyo' ? 'selected' : '' %>>Tokyo</option>
                    <option value="Australia/Sydney" <%= user.timezone === 'Australia/Sydney' ? 'selected' : '' %>>Sydney</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="language">ğŸŒ Language</label>
                  <select id="language" name="language">
                    <option value="en" <%= user.language === 'en' ? 'selected' : '' %>>English</option>
                    <option value="es" <%= user.language === 'es' ? 'selected' : '' %>>Spanish</option>
                    <option value="fr" <%= user.language === 'fr' ? 'selected' : '' %>>French</option>
                    <option value="de" <%= user.language === 'de' ? 'selected' : '' %>>German</option>
                    <option value="it" <%= user.language === 'it' ? 'selected' : '' %>>Italian</option>
                  </select>
                </div>
                <div class="form-group full-width">
                  <label for="profilePicture">ğŸ“· Profile Picture</label>
                  <input type="file" id="profilePicture" name="profilePicture" accept="image/*">
                  <small>Max file size: 5MB. Supported formats: JPG, PNG, GIF</small>
                </div>
              </div>
              <button type="submit" class="btn btn-primary">ğŸ’¾ Save Changes</button>
            </form>
          </div>

          <!-- Security Settings -->
          <div class="profile-section">
            <h3>ğŸ”’ Security Settings</h3>
            
            <!-- Change Password -->
            <div class="security-item">
              <h4>ğŸ” Change Password</h4>
              <form action="/profile/change-password" method="POST" class="security-form">
                <div class="form-group">
                  <label for="currentPassword">Current Password</label>
                  <input type="password" id="currentPassword" name="currentPassword" required>
                </div>
                <div class="form-group">
                  <label for="newPassword">New Password</label>
                  <input type="password" id="newPassword" name="newPassword" required minlength="6">
                </div>
                <div class="form-group">
                  <label for="confirmPassword">Confirm New Password</label>
                  <input type="password" id="confirmPassword" name="confirmPassword" required minlength="6">
                </div>
                <button type="submit" class="btn btn-warning">ğŸ”„ Change Password</button>
              </form>
            </div>

            <!-- Two-Factor Authentication -->
            <div class="security-item">
              <h4>ğŸ” Two-Factor Authentication</h4>
              <div class="security-status">
                <% if (user.twoFactorEnabled) { %>
                <div class="status-enabled">
                  <span class="status-indicator">âœ…</span>
                  <div>
                    <strong>2FA is enabled</strong>
                    <p>Your account is protected with two-factor authentication</p>
                  </div>
                </div>
                <div class="security-actions">
                  <form action="/profile/2fa/disable" method="POST" class="inline-form">
                    <input type="password" name="password" placeholder="Enter password to disable" required>
                    <button type="submit" class="btn btn-danger">âŒ Disable 2FA</button>
                  </form>
                  <form action="/profile/2fa/backup-codes" method="POST" class="inline-form">
                    <input type="password" name="password" placeholder="Enter password" required>
                    <button type="submit" class="btn btn-secondary">ğŸ”„ New Backup Codes</button>
                  </form>
                </div>
                <% } else { %>
                <div class="status-disabled">
                  <span class="status-indicator">âŒ</span>
                  <div>
                    <strong>2FA is disabled</strong>
                    <p>Enable two-factor authentication for better security</p>
                  </div>
                </div>
                <div class="security-actions">
                  <a href="/profile/2fa/setup" class="btn btn-success">ğŸ” Enable 2FA</a>
                </div>
                <% } %>
              </div>
            </div>
          </div>

          <!-- Account Information -->
          <div class="profile-section">
            <h3>â„¹ï¸ Account Information</h3>
            <div class="info-grid">
              <div class="info-item">
                <label>ğŸ†” User ID</label>
                <value><%= user.uuid %></value>
              </div>
              <div class="info-item">
                <label>ğŸ“… Member Since</label>
                <value><%= new Date(user.createdAt).toLocaleDateString() %></value>
              </div>
              <div class="info-item">
                <label>ğŸ”„ Last Updated</label>
                <value><%= new Date(user.updatedAt).toLocaleDateString() %></value>
              </div>
              <div class="info-item">
                <label>ğŸ‘‘ Account Type</label>
                <value><%= user.role %></value>
              </div>
              <div class="info-item">
                <label>ğŸ“Š Account Status</label>
                <value class="<%= user.isActive ? 'status-active' : 'status-inactive' %>">
                  <%= user.isActive ? 'âœ… Active' : 'âŒ Inactive' %>
                </value>
              </div>
              <div class="info-item">
                <label>ğŸ“§ Email Status</label>
                <value class="<%= user.emailVerified ? 'status-verified' : 'status-unverified' %>">
                  <%= user.emailVerified ? 'âœ… Verified' : 'âŒ Unverified' %>
                </value>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<%- include('partials/footer') %>